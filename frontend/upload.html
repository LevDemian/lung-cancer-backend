<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ê–Ω–∞–ª–∏–∑ —Å–Ω–∏–º–∫–∞</title>
    <style>
        #drop-area {
            border: 3px dashed #ccc;
            padding: 40px;
            text-align: center;
            border-radius: 10px;
            margin: 30px auto;
            max-width: 500px;
        }
        #drop-area.highlight {
            border-color: #00a;
        }
        #result img {
            max-width: 500px;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h2>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–Ω–∏–º–æ–∫ –ª—ë–≥–∫–∏—Ö</h2>

<div id="drop-area">
    <form id="upload-form">
        <input type="file" id="fileElem" accept="image/*" style="display:none">
        <label for="fileElem" style="cursor:pointer;">–í—ã–±—Ä–∞—Ç—å —Ñ–∞–π–ª</label>
    </form>
    <p>–∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª —Å—é–¥–∞</p>
</div>

<div id="result"></div>

<script>
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('fileElem');
    const result = document.getElementById('result');

    // Drag & Drop UI
    ['dragenter', 'dragover'].forEach(event => {
        dropArea.addEventListener(event, e => {
            e.preventDefault();
            dropArea.classList.add('highlight');
        });
    });

    ['dragleave', 'drop'].forEach(event => {
        dropArea.addEventListener(event, e => {
            e.preventDefault();
            dropArea.classList.remove('highlight');
        });
    });

    dropArea.addEventListener('drop', e => {
        const files = e.dataTransfer.files;
        handleFiles(files);
    });

    fileInput.addEventListener('change', () => {
        handleFiles(fileInput.files);
    });

function handleFiles(files) {
    console.log("üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ñ–∞–π–ª:", files[0]);

    const formData = new FormData();
    formData.append('file', files[0]);

    fetch('http://127.0.0.1:5000/upload', {
        method: 'POST',
        body: formData
    })
    .then(res => res.json())
    .then(uploadData => {
        if (uploadData.error) {
            result.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + uploadData.error;
            return;
        }

        console.log("‚úÖ –§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∞–ª–∏–∑:", uploadData.filename);

        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å ‚Äî –∞–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        return fetch('http://127.0.0.1:5000/analyze', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ filename: uploadData.filename })
        });
    })
    .then(res => res?.json())
    .then(analyzeData => {
        result.innerHTML = '';

        if (!analyzeData) return;

        if (analyzeData.error) {
            result.textContent = '‚ùå –û—à–∏–±–∫–∞ –∞–Ω–∞–ª–∏–∑–∞: ' + analyzeData.error;
        } else {
const { ai_confidence, risk_level, tumor_coordinates } = analyzeData;

        const summary = document.createElement('div');
        summary.innerHTML = `
            <h3>üß† –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</h3>
            <p><strong>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ò–ò:</strong> ${(ai_confidence * 100).toFixed(1)}%</p>
            <p><strong>–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:</strong> ${risk_level === 'high' ? '–≤—ã—Å–æ–∫–∏–π' : '–Ω–∏–∑–∫–∏–π'}</p>
            <p><strong>–ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º–∞—è –∑–æ–Ω–∞ –Ω–æ–≤–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è:</strong> –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –æ—Ç (${tumor_coordinates[0][0]}, ${tumor_coordinates[0][1]}) –¥–æ (${tumor_coordinates[1][0]}, ${tumor_coordinates[1][1]})</p>
        `;

        result.appendChild(summary);
            // –ï—Å–ª–∏ —É —Ç–µ–±—è –µ—Å—Ç—å output_url –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ‚Äî –ø–æ–∫–∞–∂–∏ –µ–≥–æ
            if (analyzeData.output_url) {
                const img = document.createElement('img');
                img.src = analyzeData.output_url;
                result.appendChild(img);
            }
        }
    })
    .catch(err => {
        console.error('‚ùå –û—à–∏–±–∫–∞:', err);
        result.textContent = '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ.';
        });
    }
</script>

</body>
</html>